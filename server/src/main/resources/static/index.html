<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Hello, World</title>
  <style type="text/css">
html{height:100%}
body{height:100%;margin:0px;padding:0px}
#container{height:100%}
</style>
  <script type="text/javascript" src="https://api.map.baidu.com/api?type=webgl&v=3.0&ak=vjXLi2Ip2gsST8tYG2jzzLdPpfPoStKu">
  </script>
  <script type="text/javascript" src="http://code.jquery.com/jquery-3.6.0.min.js">
  </script>
</head>

<body>
<div id="container"></div>
<script type="text/javascript">
  // GL版命名空间为BMapGL
  // 按住鼠标右键，修改倾斜角和角度

  var map = new BMapGL.Map("container");    // 创建Map实例
  map.centerAndZoom(new BMapGL.Point(116.404, 39.915), 11);  // 初始化地图,设置中心点坐标和地图级别
  map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
  var scaleCtrl = new BMapGL.ScaleControl();  // 添加比例尺控件
  map.addControl(scaleCtrl);
  var zoomCtrl = new BMapGL.ZoomControl();  // 添加比例尺控件
  map.addControl(zoomCtrl);

  //定义一个控件类
  function ZoomControl() {
    this.defaultAnchor = BMAP_ANCHOR_TOP_LEFT;
    this.defaultOffset = new BMapGL.Size(20, 20)
  }
  //通过JavaScript的prototype属性继承于BMap.Control
  ZoomControl.prototype = new BMapGL.Control();

  //自定义控件必须实现自己的initialize方法，并且将控件的DOM元素返回
  //在本方法中创建个div元素作为控件的容器，并将其添加到地图容器中
  ZoomControl.prototype.initialize = function(map) {
    //创建一个dom元素
    var div = document.createElement('div');
    //添加文字说明
    div.appendChild(document.createTextNode('更新'));
    // 设置样式
    div.style.cursor = "pointer";
    div.style.padding = "7px 10px";
    div.style.boxShadow = "0 2px 6px 0 rgba(27, 142, 236, 0.5)";
    div.style.borderRadius = "5px";
    div.style.backgroundColor = "white";
    // 绑定事件,点击一次放大两级
    div.onclick = function(e){
      $.ajax({
        type:"GET",
        url:"http://localhost:8080/victims",
        dataType:"json",
        success:function(data){
          alert(data.victims[0].locationLongitude);
          for (var i=0;i<data.victims.length;i++)
          {
            var marker = new BMapGL.Marker(new BMapGL.Point(data.victims[i].locationLongitude, data.victims[i].locationLatitude));
            map.addOverlay(marker);
          }
        }
      })
    }
    // 添加DOM元素到地图中
    map.getContainer().appendChild(div);
    // 将DOM元素返回
    return div;
  }
  //创建控件元素
  var myZoomCtrl = new ZoomControl();
  //添加到地图中
  map.addControl(myZoomCtrl);

</script>
</body>
</html>